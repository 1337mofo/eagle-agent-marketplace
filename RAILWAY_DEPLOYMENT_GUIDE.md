# Railway.app Deployment Guide - Agent Directory

**Deploying eagle-agent-marketplace to Railway.app**

---

## Pre-Deployment Checklist

‚úÖ GitHub repo exists: `eagle-agent-marketplace`
‚úÖ Stripe keys ready: `sk_live_51RRRk...`
‚úÖ Domain ready: `agentdirectory.exchange`
‚úÖ Authorization: $5/mo approved by Steve

---

## Step-by-Step Deployment

### 1. Accept Railway TOS

**Already shown in screenshot:**
- Click: **"I will not deploy any of that"** (purple button)
- We are 100% compliant (legitimate SaaS marketplace)

### 2. Create New Project

**Select: "GitHub Repository"**

This will:
1. Prompt GitHub login/authorization
2. Show list of repos
3. Select: `eagle-agent-marketplace`
4. Railway auto-detects FastAPI app

### 3. Configure Deployment

Railway will auto-detect from file structure:

```
eagle-agent-marketplace/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ main.py          ‚Üê Entry point (Railway detects this)
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt  ‚Üê Dependencies
‚îÇ   ‚îî‚îÄ‚îÄ ...
```

**Railway will ask for:**
- **Start Command:** `uvicorn main:app --host 0.0.0.0 --port $PORT`
- **Build Command:** `pip install -r requirements.txt`
- **Root Directory:** `backend/`

### 4. Add PostgreSQL Database

After initial deployment:

1. Click **"+ New"** in Railway dashboard
2. Select **"Database"**
3. Choose **"PostgreSQL"**
4. Railway automatically:
   - Creates database
   - Generates `DATABASE_URL` environment variable
   - Links to your app

### 5. Environment Variables

**Add these in Railway dashboard ‚Üí Settings ‚Üí Variables:**

```env
# Database (auto-generated by Railway)
DATABASE_URL=${POSTGRESQL_URL}

# Stripe (get from your Stripe dashboard)
STRIPE_SECRET_KEY=sk_live_YOUR_STRIPE_SECRET_KEY
STRIPE_PUBLISHABLE_KEY=pk_live_YOUR_STRIPE_PUBLISHABLE_KEY
STRIPE_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET

# RapidAPI for arbitrage fulfillment
RAPIDAPI_KEY=<get_from_rapidapi.com>

# Hugging Face (optional)
HUGGINGFACE_TOKEN=<optional>

# Platform Config
PLATFORM_COMMISSION_RATE=0.06
PLATFORM_NAME=Agent Directory
PLATFORM_URL=https://agentdirectory.exchange

# Production settings
DEBUG=False
LOG_LEVEL=INFO
```

### 6. Custom Domain Setup

**Connect agentdirectory.exchange:**

1. Railway dashboard ‚Üí Settings ‚Üí Domains
2. Click **"+ Custom Domain"**
3. Enter: `agentdirectory.exchange`
4. Railway provides DNS records:
   ```
   A     @      <railway_ip>
   CNAME www    <railway_subdomain>.railway.app
   ```
5. Add these to Namecheap DNS settings
6. Wait 5-10 minutes for propagation

### 7. SSL Certificate

Railway automatically provisions Let's Encrypt SSL:
- HTTPS enabled by default
- Auto-renewal
- No configuration needed

### 8. Update Stripe Webhook

**After deployment (once you have live URL):**

1. Go to: https://dashboard.stripe.com/webhooks
2. Click **"Add endpoint"**
3. **Endpoint URL:** `https://agentdirectory.exchange/api/v1/webhooks/stripe`
4. **Events to send:**
   - `payment_intent.succeeded`
   - `payment_intent.payment_failed`
   - `transfer.created`
   - `transfer.failed`
5. Copy **Signing secret** (starts with `whsec_`)
6. Update Railway environment variable: `STRIPE_WEBHOOK_SECRET=whsec_...`

### 9. Database Migration

**First deployment - initialize database:**

Railway auto-runs on first deploy, OR manually:

```bash
# Railway CLI (if needed)
railway run python -c "from database.base import init_db; init_db()"
```

Our `main.py` already has startup event that runs `init_db()` automatically.

### 10. Health Check

**After deployment, verify:**

```bash
# Check API is live
curl https://agentdirectory.exchange/health

# Should return:
{"status": "healthy"}

# Check API docs
# Visit: https://agentdirectory.exchange/docs
```

---

## Deployment Commands for Railway

**If Railway doesn't auto-detect, manually specify:**

### Procfile (create if needed)
```
web: uvicorn main:app --host 0.0.0.0 --port $PORT
```

### railway.json (optional config)
```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "pip install -r requirements.txt"
  },
  "deploy": {
    "startCommand": "uvicorn main:app --host 0.0.0.0 --port $PORT",
    "healthcheckPath": "/health",
    "restartPolicyType": "ON_FAILURE"
  }
}
```

---

## Post-Deployment Testing

### 1. Test Health Endpoint
```bash
curl https://agentdirectory.exchange/health
```

### 2. Test Agent Registration
```bash
curl -X POST https://agentdirectory.exchange/api/v1/agents \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Agent",
    "description": "Testing deployment",
    "agent_type": "autonomous",
    "owner_email": "test@example.com"
  }'
```

### 3. Test Stripe Webhook
```bash
# Use Stripe CLI or Dashboard webhook test
stripe trigger payment_intent.succeeded
```

### 4. Test Fulfillment
```bash
# Create test transaction
# Verify fulfillment system processes it
```

---

## Monitoring & Logs

**Railway provides:**

1. **Logs tab:** Real-time application logs
2. **Metrics tab:** CPU, memory, requests
3. **Deployments tab:** History and rollback
4. **Environment tab:** Manage variables

**Access logs:**
```bash
# Via Railway CLI
railway logs

# Via dashboard
Railway ‚Üí Project ‚Üí Logs tab
```

---

## Cost Breakdown

**Railway.app pricing:**
- **Starter Plan:** $5/month
  - Includes:
    - 500 execution hours
    - Shared CPU (0.5 vCPU)
    - 512MB RAM
    - PostgreSQL database (1GB storage)
    - SSL certificate
    - Custom domains
    - Auto-deployments from GitHub

**Should be sufficient for:**
- Up to 10,000 requests/day
- 100-500 active agents
- Early stage growth

**Upgrade later if needed:**
- Pro plan ($20/mo) for more resources
- Scale horizontally (multiple instances)

---

## Troubleshooting

### Build Failed
**Check:**
- `requirements.txt` includes all dependencies
- Python version compatible (3.10+)
- No syntax errors in code

### Database Connection Failed
**Check:**
- `DATABASE_URL` environment variable set
- Railway PostgreSQL service running
- SQLAlchemy connection string format correct

### Stripe Webhooks Not Working
**Check:**
- Webhook endpoint URL correct
- `STRIPE_WEBHOOK_SECRET` matches Stripe dashboard
- Endpoint is publicly accessible (HTTPS)
- Signature verification enabled

### Port Binding Error
**Ensure:**
- Using `$PORT` environment variable (Railway sets this)
- Binding to `0.0.0.0` not `localhost`
- Correct command: `--host 0.0.0.0 --port $PORT`

---

## Rollback Plan

**If deployment fails:**

1. **Via Railway dashboard:**
   - Go to Deployments tab
   - Click previous successful deployment
   - Click "Redeploy"

2. **Via Git:**
   ```bash
   git revert HEAD
   git push origin main
   # Railway auto-deploys previous version
   ```

---

## Security Checklist

‚úÖ All secrets in environment variables (not code)
‚úÖ `.env` files in `.gitignore`
‚úÖ Stripe webhook signature verification enabled
‚úÖ HTTPS enforced (Railway default)
‚úÖ CORS configured for production domains only
‚úÖ Database password auto-generated by Railway
‚úÖ API rate limiting enabled (TODO: add if needed)

---

## Next Steps After Deployment

1. **Test all endpoints** (health, agents, listings, transactions)
2. **Configure Stripe webhooks** with live URL
3. **Run discovery crawler** to find arbitrage deals
4. **Create SIBYSI agent listings** (8 agents ready)
5. **Test complete purchase flow** end-to-end
6. **Monitor logs** for first 24 hours
7. **Set up alerting** for errors (Railway notifications)

---

## Support Resources

**Railway:**
- Docs: https://docs.railway.app
- Discord: https://discord.gg/railway
- Status: https://status.railway.app

**Agent Directory:**
- GitHub: https://github.com/1337mofo/eagle-agent-marketplace
- Docs: `/docs` endpoint (auto-generated)

---

**Status:** Ready to deploy  
**Cost:** $5/month (approved)  
**Timeline:** 15-30 minutes to live  
**Next:** Accept TOS ‚Üí Select GitHub Repo ‚Üí Deploy

ü¶Ö **Let's get this live.**
